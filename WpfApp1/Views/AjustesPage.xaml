<Page x:Class="OrySiPOS.Views.AjustesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:OrySiPOS.Views"
      mc:Ignorable="d" 
      d:DesignHeight="800" d:DesignWidth="800"
      Title="AjustesPage"
      FontFamily="Segoe UI">

    <Page.Resources>
        <Style x:Key="SettingsCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#B0BEC5" Opacity="0.1" BlurRadius="10" ShadowDepth="2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#343a40"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#6c757d"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
    </Page.Resources>

    <Grid Background="#F4F7F9">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="30">

                <TextBlock Text="Configuración del Sistema" 
                           FontSize="28" 
                           FontWeight="Bold" 
                           Foreground="#343a40"
                           Margin="0,0,0,5"/>
                <TextBlock Text="Personaliza los datos de tu negocio y preferencias" 
                           FontSize="14" 
                           Foreground="#6c757d"
                           Margin="0,0,0,25"/>

                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="🏢" FontSize="20" Margin="0,0,10,0"/>
                            <TextBlock Text="Datos del Negocio" Style="{StaticResource SectionTitle}" Margin="0"/>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Nombre de la Tienda:" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding NombreTienda, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Text="Dirección:" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding DireccionTienda, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="RFC (Opcional):" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding RFCTienda, UpdateSourceTrigger=PropertyChanged}"/>

                                <TextBlock Text="Teléfono:" Style="{StaticResource FieldLabel}"/>
                                <TextBox Text="{Binding TelefonoTienda, UpdateSourceTrigger=PropertyChanged}"/>
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="Mensaje al final del ticket:" Style="{StaticResource FieldLabel}"/>
                        <TextBox Text="{Binding MensajeTicket, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="🖨️" FontSize="20" Margin="0,0,10,0"/>
                            <TextBlock Text="Impresión y Ticket" Style="{StaticResource SectionTitle}" Margin="0"/>
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Seleccionar Impresora:" Style="{StaticResource FieldLabel}"/>

                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <ComboBox Grid.Column="0" Height="30"
                                              ItemsSource="{Binding ListaImpresoras}"
                                              SelectedItem="{Binding ImpresoraSeleccionada}"/>

                                    <Button Grid.Column="1" 
                                            Content="⚙️ Configurar" 
                                            ToolTip="Abrir propiedades de Windows para quitar la cola de impresión"
                                            Command="{Binding AbrirPropiedadesImpresoraCommand}"
                                            Style="{StaticResource BtnSecondary}"
                                            Height="30" 
                                            Margin="10,0,0,0" 
                                            Padding="10,0"/>
                                </Grid>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Ancho de papel:" Style="{StaticResource FieldLabel}"/>
                                <ComboBox Height="30" Margin="0,0,0,15" SelectedIndex="1">
                                    <ComboBoxItem Content="58mm"/>
                                    <ComboBoxItem Content="80mm"/>
                                </ComboBox>
                            </StackPanel>
                        </Grid>

                        <CheckBox Content="Imprimir ticket al finalizar venta por defecto" 
                                  IsChecked="{Binding ImprimirTicketDefault}" 
                                  Margin="0,5"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="💾" FontSize="20" Margin="0,0,10,0"/>
                            <TextBlock Text="Base de Datos y Respaldo Local" Style="{StaticResource SectionTitle}" Margin="0"/>
                        </StackPanel>

                        <TextBlock Text="Es recomendable realizar respaldos periódicos de tu inventario y ventas para evitar pérdida de información." 
                                   Foreground="Gray" Margin="0,0,0,15" TextWrapping="Wrap"/>

                        <StackPanel Orientation="Horizontal">
                            <Button Content="Crear Respaldo Local" 
                                    Command="{Binding ExportarBaseDatosCommand}"
                                    Background="#007ACC" Foreground="White" FontWeight="Bold"
                                    Padding="15,8" BorderThickness="0" Cursor="Hand"
                                    Margin="0,0,10,0">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="4"/>
                                    </Style>
                                </Button.Resources>
                            </Button>

                            <Button Content="Restaurar Datos" 
                                    Command="{Binding ImportarBaseDatosCommand}"
                                    Background="#6c757d" Foreground="White" FontWeight="Bold"
                                    Padding="15,8" BorderThickness="0" Cursor="Hand">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="4"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SettingsCard}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="📧" FontSize="20" Margin="0,0,10,0"/>
                            <TextBlock Text="Correo para Importación XML" Style="{StaticResource SectionTitle}" Margin="0"/>
                        </StackPanel>

                        <TextBlock Text="Configura la cuenta de Gmail que recibe las facturas XML de proveedores."
                                   Foreground="Gray" Margin="0,0,0,15" TextWrapping="Wrap"/>

                        <StackPanel>
                            <TextBlock Text="Palabra Clave de Búsqueda:" Style="{StaticResource FieldLabel}"/>
                            <TextBox Text="{Binding EmailKeyword, UpdateSourceTrigger=PropertyChanged}" 
                                     ToolTip="Ej: 'Factura', 'CFDI', 'XML'. El sistema buscará correos que contengan esta palabra en el asunto."/>
                            <TextBlock Text="El sistema buscará correos NO LEÍDOS que contengan esta palabra en el asunto." 
                                       FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,15"/>

                            <TextBlock Text="Correo Electrónico (Gmail):" Style="{StaticResource FieldLabel}"/>
                        </StackPanel>
                        <TextBox Text="{Binding EmailInventario, UpdateSourceTrigger=PropertyChanged}"/>

                        <TextBlock Text="Contraseña de Aplicación:" Style="{StaticResource FieldLabel}"/>

                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <PasswordBox x:Name="PassBoxSecret" 
                                         Grid.Column="0"
                                         Height="30"
                                         VerticalContentAlignment="Center"
                                         PasswordChanged="PassBoxSecret_PasswordChanged"
                                         Padding="5"/>

                            <TextBox x:Name="TxtPassVisible" 
                                     Grid.Column="0"
                                     Height="30"
                                     Visibility="Collapsed"
                                     TextChanged="TxtPassVisible_TextChanged"/>

                            <Button Grid.Column="1" 
                                    x:Name="BtnTogglePass"
                                    Click="BtnTogglePass_Click"
                                    Style="{StaticResource BtnSecondary}"
                                    BorderThickness="1" 
                                    BorderBrush="{StaticResource BorderBrush}"
                                    Background="White"
                                    ToolTip="Mostrar/Ocultar contraseña"
                                    Width="40" Height="30" 
                                    Margin="5,0,0,0"
                                    Padding="0">
                                <TextBlock Text="👁️" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Button>
                        </Grid>

                        <TextBlock Text="⚠️ Nota: Usa una 'Contraseña de Aplicación' de Google, no tu contraseña normal." 
                                   Foreground="{StaticResource WarningColor}" FontSize="11" FontStyle="Italic" Margin="0,-10,0,0"/>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SettingsCard}" BorderBrush="OrangeRed" BorderThickness="1">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBlock Text="☁️" FontSize="20" Margin="0,0,10,0"/>
                            <TextBlock Text="Sincronización Nube (Supabase)" Style="{StaticResource SectionTitle}" Margin="0"/>
                        </StackPanel>

                        <TextBlock Text="Usa estas herramientas para sincronizar manualmente. 'Subir' envía tus datos locales a la nube. 'Bajar' trae lo de la nube a tu PC."
                   Foreground="#555" Margin="0,0,0,15" TextWrapping="Wrap"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0" 
                    Content="⬆️ SUBIR TODO A NUBE" 
                    Click="BtnForzarSubida_Click"
                    Background="OrangeRed" Foreground="White"
                    FontWeight="Bold" FontSize="12"
                    Padding="10,10" Height="45">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="6"/>
                                    </Style>
                                </Button.Resources>
                                <Button.Effect>
                                    <DropShadowEffect Color="#FF4500" BlurRadius="10" Opacity="0.3"/>
                                </Button.Effect>
                            </Button>

                            <Button Grid.Column="2" 
                    Content="⬇️ BAJAR TODO DE NUBE" 
                    Click="BtnForzarBajada_Click"
                    Background="#007ACC" Foreground="White"
                    FontWeight="Bold" FontSize="12"
                    Padding="10,10" Height="45">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="6"/>
                                    </Style>
                                </Button.Resources>
                                <Button.Effect>
                                    <DropShadowEffect Color="#007ACC" BlurRadius="10" Opacity="0.3"/>
                                </Button.Effect>
                            </Button>
                        </Grid>
                    </StackPanel>
                </Border>

                <Button HorizontalAlignment="Right" 
                        Background="#28A745" Foreground="White" FontWeight="Bold" FontSize="16"
                        Padding="30,10" BorderThickness="0" Cursor="Hand"
                        Content="Guardar Cambios"
                        Command="{Binding GuardarCommand}"
                        Margin="0,10,0,50">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="5"/>
                        </Style>
                    </Button.Resources>
                </Button>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>