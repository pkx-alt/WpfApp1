<Page x:Class="WpfApp1.Views.VentasRealizadasPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.expression/blend/2008" 
      xmlns:vm="clr-namespace:WpfApp1.ViewModels"
      xmlns:local="clr-namespace:WpfApp1.Views"
      mc:Ignorable="d" 
      d:DesignHeight="600" d:DesignWidth="800"
      Title="VentasRealizadasPage"
      Background="White">

    <Page.DataContext>
        <vm:VentasRealizadasViewModel/>
    </Page.DataContext>

    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">

            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Vertical">

                    <TextBlock Text="Historial de ventas" 
                               FontSize="24" 
                               FontWeight="Bold" 
                               Margin="0,0,0,15"/>

                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBox Grid.Column="0" 
         x:Name="TxtBusquedaHistorial" 
         VerticalContentAlignment="Center"
         Padding="5"
         Text="{Binding TextoBusqueda, UpdateSourceTrigger=PropertyChanged}"
         GotFocus="TxtBusquedaHistorial_GotFocus"
         LostFocus="TxtBusquedaHistorial_LostFocus" />
                    </Grid>

                    <WrapPanel Margin="0,0,0,10">

                        <StackPanel Orientation="Horizontal" Margin="0,5,20,5">
                            <TextBlock Text="Desde" VerticalAlignment="Center" Margin="0,0,5,0"/>

                            <DatePicker SelectedDate="{Binding FechaDesde}"/>

                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,5,20,5">
                            <TextBlock Text="Hasta" VerticalAlignment="Center" Margin="0,0,5,0"/>

                            <DatePicker SelectedDate="{Binding FechaHasta}"/>

                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,5,20,5">
                            <TextBlock Text="Cliente" VerticalAlignment="Center" Margin="0,0,5,0"/>

                            <ComboBox Width="150"
                              DisplayMemberPath="RazonSocial"
                              ItemsSource="{Binding ListaClientes}"
                              SelectedItem="{Binding ClienteSeleccionado}"/>

                        </StackPanel>

                    </WrapPanel>

                </StackPanel>

                <DataGrid Grid.Row="1" 
                          AutoGenerateColumns="False" 
                          ItemsSource="{Binding Ventas}" IsReadOnly="True"
                          CanUserAddRows="False"
                          VerticalGridLinesBrush="Transparent"
                          HorizontalGridLinesBrush="#EEE"
                          Margin="0,10,0,10">

                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Folio" Binding="{Binding Folio}" Width="2*"/>
                        <DataGridTextColumn Header="Cliente" Binding="{Binding Cliente}" Width="2*"/>
                        <DataGridTextColumn Header="Fecha y hora" Binding="{Binding FechaHora}" Width="Auto"/>
                        <DataGridTextColumn Header="Productos" Binding="{Binding Productos}" Width="Auto"/>
                        <DataGridTextColumn Header="Total" Binding="{Binding Total, StringFormat=C}" Width="*"/>

                        <DataGridTemplateColumn Header="Acciones" Width="Auto">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="Ver" Margin="5" ToolTip="Ver detalle"
        
        Command="{Binding DataContext.VerDetalleCommand, 
                  RelativeSource={RelativeSource AncestorType=Page}}"
        
        CommandParameter="{Binding}"
        />
                                        <Button Content="Imprimir" Margin="5" ToolTip="Imprimir ticket"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>

                <StackPanel Grid.Row="2" Margin="0,15,0,0">
                    <TextBlock Text="{Binding ResumenTitulo}"
           FontSize="16"
           FontWeight="SemiBold"/>

                    <Separator Margin="0,5,0,10"/>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Filtrar resumen por Depto.:" 
                                   VerticalAlignment="Center" 
                                   Margin="0,0,5,0"
                                   FontWeight="SemiBold"/>
                        <ComboBox x:Name="CmbCategoriaFilter" 
                                  Width="150"
                                  DisplayMemberPath="Nombre"
                                  ItemsSource="{Binding ListaCategorias}"
          SelectedItem="{Binding SelectedCategoria}"/>
                    </StackPanel>

                    <TextBlock Text="{Binding IngresosTotales, StringFormat='Ingresos totales: {0:C}'}" FontSize="14" Margin="0,2"/>
                    <TextBlock Text="{Binding GananciaTotal, StringFormat='Ganancia total: {0:C}'}" FontSize="14" Margin="0,2"/>
                    <TextBlock Text="{Binding NumVentas, StringFormat='Número de ventas: {0}'}" FontSize="14" Margin="0,2"/>
                    <TextBlock Text="{Binding TicketPromedio, StringFormat='Ticket promedio: {0:C}'}" FontSize="14" Margin="0,2"/>
                </StackPanel>

            </Grid>
        </ScrollViewer>
    </Grid>
</Page>