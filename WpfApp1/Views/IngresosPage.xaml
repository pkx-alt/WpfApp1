<Page x:Class="WpfApp1.Views.IngresosPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:WpfApp1.Views"
      xmlns:vm="clr-namespace:WpfApp1.ViewModels"
      mc:Ignorable="d" 
      d:DesignHeight="600" d:DesignWidth="900"
      Title="IngresosPage"
      FontFamily="Segoe UI">

    <Page.Resources>
        <SolidColorBrush x:Key="ColorPrimario" Color="#28A745"/>
        <SolidColorBrush x:Key="ColorFondo" Color="#F4F7F9"/>
        <SolidColorBrush x:Key="ColorTextoPrincipal" Color="#37474F"/>
        <SolidColorBrush x:Key="ColorSeleccionSuave" Color="#E8F5E9"/>
        <Style x:Key="DataGridModerno" TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#EEEEEE"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="RowHeight" Value="45"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#455A64"/>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#90A4AE"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="15,0,0,0"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
        </Style>

        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FAFAFA"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource ColorSeleccionSuave}"/>
                    <Setter Property="Foreground" Value="{StaticResource ColorPrimario}"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="15,0"/>
        </Style>

    </Page.Resources>

    <Grid Background="{StaticResource ColorFondo}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="30,30,30,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                <TextBlock Text="Gestión de Ingresos" FontSize="28" FontWeight="Bold" Foreground="{StaticResource ColorTextoPrincipal}"/>
                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock Text="Historial de entradas de dinero y ajustes" FontSize="14" Foreground="#78909C"/>
                </StackPanel>
            </StackPanel>

            <Border Grid.Column="1" Background="White" CornerRadius="10" Padding="25,15">
                <Border.Effect>
                    <DropShadowEffect Color="#B0BEC5" Opacity="0.2" BlurRadius="15" ShadowDepth="3"/>
                </Border.Effect>
                <StackPanel>
                    <TextBlock Text="Total Ingresos (Mes Actual)" FontSize="12" Foreground="#90A4AE" HorizontalAlignment="Right" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding TotalIngresosMes, StringFormat='c'}" 
                               FontSize="32" FontWeight="Bold" 
                               Foreground="{StaticResource ColorPrimario}" 
                               HorizontalAlignment="Right" Margin="0,2,0,0"/>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Grid.Row="1" Margin="30,0,30,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="White" CornerRadius="6" Padding="5" BorderBrush="#CFD8DC" BorderThickness="1">
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Fecha:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="SemiBold"/>
                    <DatePicker Width="110" VerticalContentAlignment="Center" SelectedDate="{Binding FechaInicio}"/>
                    <TextBlock Text="➔" VerticalAlignment="Center" Foreground="#B0BEC5" Margin="5,0"/>
                    <DatePicker Width="110" BorderThickness="0" VerticalContentAlignment="Center" SelectedDate="{Binding FechaFin}"/>
                </StackPanel>
            </Border>

            <Border Grid.Column="2" Margin="20,0" Background="White" CornerRadius="6" BorderBrush="#CFD8DC" BorderThickness="1" Width="250">
                <Grid>
                    <TextBlock Text="🔍" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="10,0,0,0" Foreground="#B0BEC5"/>
                    <TextBox BorderThickness="0" Background="Transparent" VerticalContentAlignment="Center" Padding="30,0,10,0" 
                 Text="{Binding TextoBusqueda, UpdateSourceTrigger=PropertyChanged}" 
                 ToolTip="Buscar por concepto... " Foreground="#333"/>
                </Grid>
            </Border>

            <Button Grid.Column="3" Height="35" Width="170" Background="{StaticResource ColorPrimario}" BorderThickness="0" Cursor="Hand"
                    x:Name="BtnRegistrarIngreso" Click="BtnRegistrarIngreso_Click">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="6"/>
                    </Style>
                </Button.Resources>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="+" Foreground="White" FontWeight="Bold" FontSize="16" Margin="0,0,10,0"/>
                    <TextBlock Text="REGISTRAR INGRESO" Foreground="White" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </Grid>

        <Border Grid.Row="2" Margin="30,0,30,30" Background="White" CornerRadius="8">
            <Border.Effect>
                <DropShadowEffect Color="#B0BEC5" Opacity="0.15" BlurRadius="10" ShadowDepth="2"/>
            </Border.Effect>

            <DataGrid x:Name="GridIngresos" 
                      Style="{StaticResource DataGridModerno}"
                      ItemsSource="{Binding IngresosFiltrados}"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False"
                      BorderThickness="0"
                      ClipToBounds="True">

                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Fecha" Width="140">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="10,0,0,0">
                                    <Path Data="M19,4H18V2H16V4H8V2H6V4H5A2,2 0 0,0 3,6V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V6A2,2 0 0,0 19,4M19,20H5V10H19V20M19,8H5V6H19V8Z" 
                                          Fill="#B0BEC5" Width="14" Height="14" Stretch="Uniform" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding Fecha, StringFormat='dd MMM yyyy'}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Categoría" Width="140">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="#D4EDDA" CornerRadius="4" Padding="8,4" HorizontalAlignment="Left">
                                    <TextBlock Text="{Binding Categoria}" Foreground="#155724" FontWeight="SemiBold" FontSize="11"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="Descripción" Width="*" Binding="{Binding Concepto}"/>

                    <DataGridTextColumn Header="Usuario" Width="110" Binding="{Binding Usuario}" Foreground="#90A4AE"/>

                    <DataGridTemplateColumn Header="Monto" Width="130">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Monto, StringFormat=c}" 
                                           Foreground="{StaticResource ColorPrimario}" 
                                           FontWeight="Bold" 
                                           FontSize="14"
                                           HorizontalAlignment="Right"
                                           VerticalAlignment="Center"
                                           Margin="0,0,20,0"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="" Width="60">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Width="30" Height="30" Background="Transparent" BorderThickness="0" Cursor="Hand" ToolTip="Ver Detalle">
                                    <Grid>
                                        <Ellipse Width="28" Height="28" Fill="#F5F5F5"/>
                                        <Path Data="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"
                                              Fill="Gray" Width="14" Height="14" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</Page>